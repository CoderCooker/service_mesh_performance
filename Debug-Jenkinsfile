pipeline {
    agent any
    stages {

        stage('Deploy the first 5 clustes on kind-deployment-Slave1') {
            agent {
                label "kind-deployment-Slave1"
            }
            steps {
                sh "echo 'hello from kind-deployment-Slave1'"
                sh 'hostname'
                sh '/home/centos/workspace/exhaust-slave-0618PM/kind get clusters'
                sh 'docker exec -i execution /bin/bash -c \'cd /home/centos/workspace/exhaust-slave-0618PM && export WORKSPACE=/home/centos/workspace/exhaust-slave-0618PM && python3.7 library/pyfra.py --tests-dir setup/client_cluster --cluster-type kind --clusters slave-1-cls-1 --log-dir . --debug --csp-token kJfh2ZsImeLwv3AT7zGuTFTuRv8OpdIkydseLluytz3pdU6rajZBP3aHV1HQoOCW --clusters-per-tenant 1 --apps-per-cluster 20\''
                sh 'pwd'
                sh 'free -mh'
                sh 'df -mh'
            }
        }

        stage('Collect MeasureMeant after the first 5 clusters.') {
            agent {
                label "master"
            }
            steps {
                sh "echo 'hello from master'"
                sh 'hostname'
                sh '/var/lib/jenkins/kind get clusters'
                sh 'cd /var/lib/jenkins/workspace/RestHTTP_Measurement'
                sh 'export WORKSPACE=/var/lib/jenkins/workspace/RestHTTP_Measurement'
                sh 'sh 'python3.7 library/pyfra.py --tests-dir tsm_apis/graphql --log-dir . --debug'
            }
        }

        stage('Test On aws-slave-21') {
            agent {
                label "aws-slave-21"
            }
            steps {
                sh "echo 'hello from aws-slave-21'"
                sh 'hostname'
                sh '/home/centos/workspace/exhaust-slave-21/kind get clusters'
                sh 'free -mh'
                sh 'df -mh'
                sh 'pwd'
            }
        }
    }
}
